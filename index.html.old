<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8">
    <meta http-equiv="content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Deadly Timeline | Global Causes of Death Visualization #tsne #who #d3plus #dataviz #d3js @csaladenes" />
    <meta name="keywords" content="csaladenes, d3.js, data visualization, infographic, d3plus, d3, who, COD, causes of death, mortality, death, disease, data visualization, mit oec, mit, mit atlas, macro connections" />
    <meta property="og:image" content="http://blog.csaladen.es/health/deadly_timeline_global_causes_of_death_visualization.png" />
	<meta property="twitter:image" content="http://blog.csaladen.es/health/deadly_timeline_global_causes_of_death_visualization.png" />
    <meta property="og:description" content="Deadly Timeline | Global Causes of Death Visualization #tsne #who #d3plus #dataviz #d3js @csaladenes" />
	<meta property="twitter:description" content="Deadly Timeline | Global Causes of Death Visualization #tsne #who #d3plus #dataviz #d3js @csaladenes" />
    <meta property="og:title" content="Deadly Timeline | Global Causes of Death Visualization" />
	<meta property="twitter:title" content="Deadly Timeline | Global Causes of Death Visualization" />
    <meta http-equiv="content-Type" content="text/html; charset=utf-8" />
	<meta property="og:url" content="https://csaladenes.wordpress.com/?p=821"/>
	<meta property="twitter:url" content="https://csaladenes.wordpress.com/?p=821"/>
    <meta property="og:site_name" content="Try something new. Everyday." />
    <meta property="fb:admins" content="100943737036023614165" />
	<link rel="shortcut icon" href="../tsne.png" />
	<link rel="publisher" href="https://plus.google.com/106181965793093327960" />
    <title>Deadly Timeline | Global Causes of Death Visualization</title>
	<style>
@font-face {
	font-family: "Righteous";
	src: url(Righteous-Regular.ttf) format("truetype");
}
.logo, .viz, #social {
 	-webkit-transition: opacity 0.5s;
	  -moz-transition: opacity 0.5s;
	  -o-transition: opacity 0.5s;
	  -ms-transition: opacity 0.5s;
	  transition: opacity 0.5s;
}
.viz{
	width: -moz-calc(100% - 200px);
	width: -webkit-calc(100% - 200px);
	width: calc(100% - 200px);
}
a{
	font-family:Righteous;
	text-decoration:none;
}
a:hover{
	font-family:Righteous;
	text-decoration:underline;
}
a:visited{
	color: #444;
}
.logo:hover{
	cursor:pointer;
}
#social {
	text-decoration: none;
	padding-top:1px;
	white-space:nowrap;
	overflow:hidden;
}
.socialico{
	width:21px;
	height:21px;
}
</style>

<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "505a26ad-d820-47bd-a500-7f49d04a30f5", doNotHash: false, doNotCopy: false, hashAddressBar: true,shorten:false});</script>

</head>

<!-- load D3js -->
<script src="d3.js"></script>

<!-- load D3plus after D3js -->
<script src="d3plus.js"></script>

<script src="jszip.min.js"></script>
<script src="JSZipUtils.min.js"></script>
<script src="svgexport.js"></script>

<body link="#444">
<!-- create container element for visualization -->
<a id="pngdownload" href="" download="" style="visibility:hidden;display:none;position:fixed;top:0px;left:0px;width:0px;height:0px;"></a>


<div style="position: fixed;
    left: 50%;
    top: 50%;
    height: 150px;
    margin-top: -168px;
    width: 150px;
    margin-left: -170px;" class="loading">
<img style="position: absolute;
    left: 0px;
    top: 0px;
    z-index: 51;
    height: 30px;
    margin-top: 110px;
	margin-left: 60px;
    width: 30px;" src="b.gif"/>
<img style="position: absolute;
    left: 0px;
    top: 0px;
    z-index: 50;
    height: 150px;
    width: 150px;
    border:2px solid #b8371d;" src="tsne.png"/>
</div>

<div style="position: fixed;
    right: 20px;
    top: 70px;
    z-index: 101;
	opacity: 0;
    height: 100%
	width:190px;" class="logo">
	<img style="position: absolute;
    right: 60px;
    top:250px;
    height: 52px;
	border: solid 1px #888;
    width: 52px;" src="stacked.png"
	alt="Timeline"
	title="Timeline"
	onclick='show(1);'>
	<img style="position: absolute;
    right: 0px;
    top: 250px;
    height: 52px;
	border: solid  1px #888;
    width: 52px;" src="tree.png"
	alt="Treemap"
	title="Treemap"
	onclick='show(2);'>
	<img style="position: absolute;
    right: 120px;
    top: 250px;
    height: 52px;
	border: solid  1px #888;
    width: 52px;" src="line.png"
	alt="Line Plot"
	title="Line Plot"
	onclick='show(3);'>
	<img style="position: absolute;
    right: 0px;
    top: 0px;
	border: solid  1px #888;
    width: 173px;height:135;" src="deadly_timeline_global_causes_of_death_visualization.png"
	alt="Deadly Timeline Logo">
	<div style="position: absolute;
    right: 0px;
    top: 385px;
    height: 2px;
	background-color:#ccc;
	width: 174px;"></div>
	<div style="position: absolute;
    right: 0px;
    top: 230px;
    height: 2px;
	background-color:#ccc;
	width: 174px;"></div>
	<div id="social" style="z-index:102;position: absolute;
    right: 0px;
	height:35px;
    top: 405px;">
		<span class='st_facebook_custom'><img class="socialico" src="http://www.iconsdb.com/icons/download/silver/facebook-3-24.ico"></span>
		<!--<span class='st_fblike'></span>-->
		<span class='st_twitter_custom'><img class="socialico" src="http://www.iconsdb.com/icons/download/silver/twitter-3-24.ico"></span>
		<span class='st_googleplus_custom'><img class="socialico" src="http://www.iconsdb.com/icons/download/silver/google-plus-3-24.ico"></span>
		<span class='st_linkedin_custom'><img class="socialico" src="http://www.iconsdb.com/icons/download/silver/linkedin-3-24.ico"></span>
		<!--<span class='st_tumblr_custom'><img class="socialico" src="http://www.iconsdb.com/icons/download/silver/tumblr-3-24.ico"></span>-->
		<!--<span class='st_reddit_custom'><img class="socialico" src="reddit.png"></span>-->
		<span class='st_email_custom'><img class="socialico" src="http://www.iconsdb.com/icons/download/silver/email-13-24.ico"></span>
		<a href="" download="" id="csvdownload" ><span><img class="socialico" src="http://www.iconsdb.com/icons/download/silver/csv-24.ico"></span></a>
		<span id="pngdownloadwrapper"><img class="socialico" src="http://www.iconsdb.com/icons/download/silver/png-24.ico"></span>
	</div>


<a href="https://csaladenes.wordpress.com/?p=821" target="_blank">

<img style="position: absolute;
    right: 128px;
    top: 155px;
    height: 40px;
    width: 40px; border:1px solid #b8371d;" alt="Description"
	title="Description" src="tsne.png"/>
	<div style="position: absolute;
    right: 134px;
    top: 200px;
    height: 22px;
	font-size:10px;
	font-family: Righteous;
	text-align:center;
	white-space: nowrap;
    width: 40px;"/>description</div></a>
<a href="http://d3plus.org" target="_blank">
<img style="position: absolute;
    right: 41px;
    top: 159px;
    height: 40px;
    width: 40px;" alt="Created with D3plus"
	title="Created with D3plus" src="http://www.csaladen.es/img/group5/d3plus.png"/>
	<div style="position: absolute;
    right: 41px;
    top: 200px;
    height: 22px;
	font-size:10px;
	font-family: Righteous;
	text-align:center;
	white-space: nowrap;
    width: 40px;"/>engine</div></a>
<a href="http://www.csaladen.es" target="_blank">
<img style="position: absolute;
    right: 0px;
    top: 160px;
    height: 40px;
    width: 40px;" alt="Created by Denes Csala &copy; 2016"
	title="Created by Denes Csala &copy; 2016" src="http://www.csaladen.es/favicon.png"/>
	<div style="position: absolute;
    right: 0px;
    top: 200px;
    height: 22px;
	font-size:10px;
	font-family: Righteous;
	text-align:center;
	white-space: nowrap;
    width: 40px;"/>credit</div></a>
<a href="http://www.who.int/healthinfo/mortality_data/en/" target="_blank">
<img style="position: absolute;
    right: 81px;
    top: 156px;
    height: 40px;
    width: 40px;" alt="Data source: WHO"
	title="Data source: WHO" src="http://www.who.int/sysmedia/media/resources/apple-touch-icon.png"/>
	<div style="position: absolute;
    right: 81px;
    top: 200px;
    height: 22px;
	font-size:10px;
	font-family: Righteous;
	text-align:center;
	white-space: nowrap;
    width: 40px;"/>data</div></a>
	<div style="position: absolute;
    right: 60px;
    top: 308px;
    height: 22px;
	font-size:12px;
	font-family: Righteous;
	text-align:center;
    width: 52px;"
	alt="Timeline"
	title="Timeline"
	onclick='show(1);'>Timeline</div>
	<div style="position: absolute;
    right: 0px;
    top: 308px;
    height: 22px;
	font-size:12px;
	font-family: Righteous;
	text-align:center;
    width: 52px;"
	alt="Treemap"
	title="Treemap"
	onclick='show(2);'>Treemap</div>
	<div style="position: absolute;
    right: 120px;
    top: 308px;
    height: 22px;
	font-size:12px;
	font-family: Righteous;
	text-align:center;
    width: 52px;"
	alt="Line Plot"
	title="Line Plot"
	onclick='show(3);'>Line Plot</div>

	<div style="position: absolute;
    right: -5px;
    top: 330px;
    alt="Select Country"
	title="Select Country" id="countrylist"></div>

</div>

<div style="position: fixed; opacity:0;
    left: 5;
    top: 5;
    z-index: 100;" id="viz1" class="viz"></div>
<div style="position: fixed; opacity:0;
    left: 5;
    top: 5;
    z-index: 99;" id="viz2" class="viz"></div>
<div style="position: fixed; opacity:0;
    left: 5;
    top: 5;
    z-index: 99;" id="viz3" class="viz"></div>

<script>
  // sample data array

  var initcountry='Hungary';
  var initviz=1;
  var sca="linear";
  var center="+";

  function sethash(){
	  scale=(sca=="linear")?0:1;
	  window.location.hash="&viz_"+initviz+"&scale_"+scale+"&country_"+initcountry;
  }
  //hashing, startup, etc
  var hash=window.location.hash;
  if (hash==""){
	sethash();
  }
  else {
	if (hash.indexOf("&country_")>-1) {
		var cloc=hash.search("&country_");
		var cdummy=hash.slice(cloc+9)
		var cloc=cdummy.search("&");
		initcountry=(cloc>-1)?cdummy.slice(0,cloc):cdummy;
	}
	if (hash.indexOf("&viz")>-1) {
		var cloc=hash.search("&viz_");
		initviz=hash.slice(cloc+5,cloc+6)
	}
	if (hash.indexOf("&scale")>-1) {
		var cloc=hash.search("&scale_");
		scale=hash.slice(cloc+7,cloc+8)
	}
  }

  sca=(scale==1)?"share":"linear";

  setTimeout(function(){d3.selectAll(".logo").style("opacity",1)},1000)

  var showd=[true,true,true];

  var visualization = d3plus.viz().container("#viz1")
  var visualization2 = d3plus.viz().container("#viz2")
  var visualization3 = d3plus.viz().container("#viz3")

  var load=function(){};

  function show(a){

    initviz=a;
    sethash();

	d3.select("#viz1").style("opacity",0);
	d3.select("#viz2").style("opacity",0);
	d3.select("#viz3").style("opacity",0);
	d3.select("#viz1").style("z-index",99);
	d3.select("#viz2").style("z-index",99);
	d3.select("#viz3").style("z-index",99);
	d3.select("#viz3").style("z-index",99);

	d3.select("#viz"+a).style("z-index",100);
	d3.select("#viz"+a).style("opacity",1);

	if (showd[a-1]) { //draw if on first clikc/load
		load(initcountry,a);
		showd[a-1]=false;
	}
  }

  var path = "https://dl.dropboxusercontent.com/u/531697/datarepo/Set/json/" //default
  
  d3.json(path+'countries.json',function(countries){ //countries without w has Szekelyland and other historical regions of Romania
  JSZipUtils.getBinaryContent(path+initcountry+'.zip', function(err, rawdata) {

	  var order={
		"1001":25,
		"1026":10
	  }

	  var color={
		"1026":"#b22200",
		"1062":"#b02200"
	   }

	  function extend(rawdata){
		  var zip = new JSZip(rawdata);
		  var data=JSON.parse(zip.files['data.json'].asText());
		  
		  data.forEach(function(d) {
			//d["icon"]="img/"+hierarchy[d["c"]]["group"]+".png";
			//d["color"]=color[hierarchy[d["c"]]["group"]];
		  });

		  return data;
	  }

	  function cap1(string) {
		return string.charAt(0).toUpperCase() + string.slice(1);
	  }

	  function textformatter(text, params) {
		if (text === "s") {
		  return "Cases";
		}
		else {
		  return d3plus.string.title(text, params);
		}
	  };

	  function numberformatter(number, params) {
	    number=Math.abs(number);
        var formatted = d3plus.number.format(number, params);
		if (params.key === "ps") {
          return formatted + " TWh";
        }
        else {
          return formatted + " TWh";
        }
      };

	  data=extend(rawdata);
		
	  var font = {"family":"Righteous","size":15};
	  
	  var countrylist=[];
	  countries.forEach(function(d,i) {
		var dummy={"country":d};
		countrylist.push(dummy);
	  });
	  
	  var countrydrop = d3plus.form()
		.data(countrylist)
		.container("#countrylist")
		.font({"family":"Righteous","size":15,"align":"center","secondary":{"family":"Righteous"}})
		.id("country")
		.width(174)
		.text("country")
		.focus(initcountry,function(d){
			showd=[true,true,true];
			showd[initviz-1]=false;
			load(d,initviz);
		})
		.type("drop")
		.draw()
	
  	  d3.select("#pngdownloadwrapper")
		.on("click",function(){
			seturl();
			setTimeout(function(){d3.select("#pngdownload").node().click();},500);
		})

	  function seturl(){
		exportInlineSVG(d3.select("#viz"+initviz).select("#d3plus").node(), function(data) {
			d3.select("#pngdownload").node().href=data;
			d3.select("#pngdownload").node().download=initcountry+"_"+((initviz==1)?"Timeline":(initviz==2)?"Treemap":"Line_Plot")+".png";
		});
	  }

	  visualization
		.type("stacked")    // visualization type
		.data({"value":data,"visibility":"hidden"})
		.id({"value":['c','f'],"solo":["p"]})
		.depth(1)
		.aggs({"y": "mean"})
		.y({"value":"e","label":"Energy"})         // key to use for y-axis
		.time({"value":"y"})
		.x({"value":"y","label":"Year"})          // key to use for x-axis
		.margin("0px 30px 10px 20px")
		.font(font)
		.legend({"filters":true,"size":30})
		.messages({"style":false,"branding":false})
		.axes({"background": {"color": "#eee"}})
		.shape({"interpolate": "basis"})
		.ui({"font":{"size":12},"value":[
		  {
			"method" : "y",
			"value"  :[{"EIA":"e"}, {"BP":"b"}, {"AVG":"a"}, {"NAVG":"n"}],
			"label" : "Data source"
		  },
		  {
			"method" : function(value){
			visualization
			.id({"solo":value})
			.draw()
			},
			"value"  :[{"Production":"p"}, {"Consumption":"c"}],
			"label" : "Data type"
		  }]
		})
		//.draw()             // finally, draw the visualization!

		firstrun=false;

		load=function(country,viz) {

	   // instantiate JSZip, load and unzip data
		  JSZipUtils.getBinaryContent(path+country+'.zip', function(err, rawdata) {

   		  if (firstrun){
			initcountry=country;
			data=extend(rawdata);
		  }
		
		  d3.select("#csvdownload").node().href=path+country+'.zip';
		  d3.select("#csvdownload").node().download=country+'.zip';
		  d3.select("#pngdownload").node().download=country+"_"+((initviz==1)?"Timeline":(initviz==2)?"Treemap":"Line_Plot")+".png";

		  sethash();
		  //seturl();
		  ((viz==1) ? visualization : (viz==2) ? visualization2 : visualization3)
			  .data(data)
			  .title(country)
			  .draw()

		  firstrun=true;

		})
		};

		show(initviz); //initialize viz;
		setTimeout(function(){seturl()},20000)
  })
  })
</script>
</body>
</html>
